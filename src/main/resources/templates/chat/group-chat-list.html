<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="_csrf" th:content="${_csrf.token}">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <title>Runnity</title>
  <link th:href="@{/css/footer.css}" rel="stylesheet"/>
  <link href="/chat/css/group-chat-list.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
</head>
<body>

<div th:replace="~{partials/header :: header}"></div>

<main class="content">
  <div class="page-container">
    <div class="search-bar">
      <input placeholder="모임명, 지역을 검색해 주세요" type="text">
    </div>

    <!--    <div class="chat-rooms">-->
    <!--      <div class="chat-room-card" th:each="room : ${chatRooms}"-->
    <!--           th:onclick="'joinAndGo(' + ${room.chatRoomId} + ')'">-->
    <!--        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>-->
    <!--        <img-->
    <!--            alt="채팅방 이미지"-->
    <!--            th:src="${room.imageUrl != null and room.imageUrl != '' ? room.imageUrl : '/images/image-upload.png'}">-->
    <!--        <div class="chat-room-info">-->
    <!--          <h2 th:text="${room.chatRoomName}">채팅방 이름</h2>-->
    <!--          <p th:text="${room.description}">채팅방 설명</p>-->
    <!--          <div class="chat-room-meta">-->
    <!--            <span><img src="/images/runnity-address.png" style="width: 20px; height: 25px;"> <span-->
    <!--                th:text="${room.region}">지역</span></span>-->
    <!--            <span><img src="/images/runnity-person.png" style="width: 20px; height: 26px;"> <span-->
    <!--                th:text="${#lists.size(room.members)}">0</span></span>-->
    <!--          </div>-->
    <!--        </div>-->
    <!--      </div>-->
    <!--    </div>-->

    <div class="chat-rooms">
      <div class="chat-room-card"
           th:each="room : ${chatRooms}"
           onclick="openPreview(this)"
           th:attr="data-id=${room.chatRoomId},
                    data-title=${room.chatRoomName},
                    data-desc=${room.description},
                    data-img=${(room.imageUrl != null and room.imageUrl != '') ? room.imageUrl : '/images/image-upload.png'},
                    data-owner=${(room.ownerNickname)}">
        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>
        <img alt="채팅방 이미지"
            th:src="${room.imageUrl != null and room.imageUrl != '' ? room.imageUrl : '/images/image-upload.png'}">
        <div class="chat-room-info">
          <h2 th:text="${room.chatRoomName}">채팅방 이름</h2>
          <p th:text="${room.description}">채팅방 설명</p>
          <div class="chat-room-meta">
            <span><img src="/images/runnity-address.png" style="width: 20px; height: 25px;"> <span
                th:text="${room.region}">지역</span></span>
            <span><img src="/images/runnity-person.png" style="width: 20px; height: 26px;"> <span
                th:text="${#lists.size(room.members)}">0</span></span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <button class="floating-create-btn" id="createChatBtn" onclick="location.href='/chat-room/create'">
    <span>+</span>
  </button>
</main>

<div th:replace="~{partials/footer :: footer}"></div>

<!-- 모달창 -->
<div id="roomPreview" class="room-modal hidden" aria-hidden="true">
  <div class="room-modal__backdrop" data-close="true"></div>
  <div class="room-modal__card" role="dialog" aria-modal="true" aria-labelledby="pvTitle">
    <button class="room-modal__close" type="button" aria-label="닫기" data-close="true">✕</button>

    <div class="room-modal__body">
      <img id="pvImg" alt="채팅방 이미지" />
      <div class="room-modal__info">
        <h3 id="pvTitle">
          <span id="pvTitleText">방 제목</span>
          <span id="pvLabel" class="pv-label"></span>
        </h3>
        <p id="pvDesc" class="pv-desc">방 설명</p>
        <div class="pv-meta">
          <span class="pv-owner-label">방장</span>
          <span id="pvOwner" class="pv-owner">닉네임</span>
        </div>
      </div>
    </div>

    <div class="room-modal__actions">
      <button id="pvJoinBtn" type="button" class="pv-join">참여하기</button>
      <button type="button" class="pv-cancel" data-close="true">닫기</button>
    </div>
  </div>
</div>

<div th:if="${alert}">
  <script th:inline="javascript">
    /*<![CDATA[*/ alert([[${alert}]]); /*]]>*/
  </script>
</div>

<script src="/chat/js/group-chat-list.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>