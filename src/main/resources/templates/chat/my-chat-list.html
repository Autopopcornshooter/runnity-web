<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="_csrf" th:content="${_csrf.token}">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <title>내 채팅방 | Runnity</title>
  <link href="/chat/css/my-chat-list.css" rel="stylesheet">
</head>
<body>

<header class="header">
  <a class="main-logo" th:href="@{/main}">
    <h1>
      <img alt="Runnity Logo" src="/images/unit-logo.png" width="32">
      Runnity
    </h1>
  </a>
  <input id="searchInput" placeholder="모임명, 지역을 검색해 주세요" type="text">
  <div class="header-btns">
    <button class="btn" onclick="location.href='/chat-room/list'">채팅 목록</button>

    <button class="logout-btn" form="signOutForm" type="submit">로그아웃</button>
    <form id="signOutForm" method="post" style="display : none" th:action="@{/api/auth/signOut}">
    </form>
  </div>
</header>

<div class="chat-container">
  <!-- 채팅방 목록 -->
  <aside class="chat-list">
    <div class="tab-buttons">
      <button class="active" id="groupTab">그룹</button>
      <button id="duoTab">듀오</button>
    </div>
    <ul id="chatRooms">
      <li class="chat-room-item" onclick="openChat(this.getAttribute('data-id'))"
          th:data-id="${room.chatRoomId}" th:data-type="${room.chatRoomType}"
          th:each="room : ${chatRooms}">
        <img alt="chat image" th:if="${room.imageUrl != null}" th:src="${room.imageUrl}">
        <img alt="default image" th:src="@{/images/image-upload.png}"
             th:unless="${room.imageUrl != null}">
        <div class="room-info">
          <span class="room-name" th:text="${room.chatRoomName}">채팅방 이름</span>
          <span class="room-members">
            <img src="/images/runnity-person.png"
                 style="width: 15px; height: 19px; padding-top: 5px">
            <span th:text="${#lists.size(room.members)}">0</span>
          </span>
        </div>
      </li>
    </ul>
  </aside>

  <!-- 채팅창 -->
  <section class="chat-area">
    <div id="chatHeader">
      <h2 id="chatTitle">채팅방 선택</h2>
      <div class="chat-header-btn">
        <button class="edit-btn" id="editBtn">채팅방 수정</button>
        <button class="exit-btn" id="exitBtn">나가기</button>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages">
      <p class="placeholder">왼쪽에서 채팅방을 선택하세요.</p>
    </div>

    <div class="chat-input" id="chat-input">
      <input id="messageInput" placeholder="메시지를 입력하세요." type="text">
      <button id="sendBtn">전송</button>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script th:inline="javascript">
  /*<![CDATA[*/
  const chatRoomsData = /*[[${chatRooms}]]*/ [];
  const currentUserId = /*[[${currentUserId}]]*/ 0;
  /*]]>*/
</script>
<script src="/chat/js/my-chat-list.js"></script>
</body>
</html>
