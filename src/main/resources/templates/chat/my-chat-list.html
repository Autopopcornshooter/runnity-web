<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="_csrf" th:content="${_csrf.token}">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <title>내 채팅방 | Runnity</title>
  <link href="/chat/css/my-chat-list.css" rel="stylesheet">
  <link th:href="@{/css/footer.css}" rel="stylesheet"/>
  <link href="/chat/css/group-chat-list.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
</head>
<body>

<div th:replace="~{partials/header :: header}"></div>

<div class="chat-container">
  <!-- 채팅방 목록 -->
  <aside class="chat-list">
    <div class="tab-buttons">
      <button class="active" id="groupTab">그룹</button>
      <button id="duoTab">듀오</button>
    </div>
    <ul id="chatRooms">
      <li class="chat-room-item" onclick="openChat(this.getAttribute('data-id'))"
          th:data-id="${room.chatRoomId}" th:data-type="${room.chatRoomType}"
          th:each="room : ${chatRooms}">
        <img alt="chat image" th:if="${room.imageUrl != null}" th:src="${room.imageUrl}">
        <img alt="default image" th:src="@{/images/image-upload.png}"
             th:unless="${room.imageUrl != null}">
        <div class="room-info">
          <span class="room-name" th:text="${room.chatRoomName}">채팅방 이름</span>
          <span class="room-members">
            <img src="/images/runnity-person.png"
                 style="width: 15px; height: 19px; padding-top: 5px">
            <span th:text="${#lists.size(room.members)}">0</span>
          </span>
        </div>
        <span class="unread-badge"
              th:if="${room.unreadCount > 0}"
              th:text="${room.unreadCount > 99 ? '99+' : room.unreadCount}">
        </span>
      </li>
    </ul>
  </aside>

  <!-- 채팅창 -->
  <section class="chat-area">
    <div id="chatHeader">
      <div id="chatTitleWrap">
        <h2 id="chatTitle">채팅방 선택</h2>
        <p id="chatDesc" class="chat-desc" style="display:none;"></p>
      </div>
      <div class="chat-header-btn">
        <button class="edit-btn" id="editBtn">채팅방 수정</button>
        <button class="exit-btn" id="exitBtn">나가기</button>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages">
      <p class="select-chat-room">왼쪽에서 채팅방을 선택하세요.</p>
    </div>

    <div class="chat-input" id="chat-input">
      <input id="messageInput" placeholder="메시지를 입력하세요." type="text">
      <button id="sendBtn">전송</button>
    </div>
  </section>
</div>

<div th:replace="~{partials/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script th:inline="javascript">
/*<![CDATA[*/
const chatRoomsData = /*[[${chatRooms}]]*/ [];
const currentUserId = /*[[${currentUserId}]]*/ 0;
/*]]>*/
</script>
<script src="/chat/js/my-chat-list.js"></script>
</body>
</html>
