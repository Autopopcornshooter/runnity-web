<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Runnity íšŒì›ê°€ì…</title>
  <script
      th:src="@{|https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=${naverClientId}&submodules=geocoder|}"
      type="text/javascript"></script>
  <script defer th:src="@{/js/mapAPI.js}"></script>
  <link rel="stylesheet" th:href="@{/css/signup.css}">
</head>
<body>
<header>
  <div class="header-inner">
    <img alt="Runnity ë¡œê³ " th:src="@{/images/running.png}">
    <h1>Runnity</h1>
  </div>
</header>
<div class="container">
  <!-- íšŒì›ê°€ì… í¼ -->
  <div class="signup-section">


    <form id="signUpForm" method="post" th:action="@{/api/auth/signUp}">
      <!-- CSRF -->
      <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden"/>

      <label for="loginId">ì•„ì´ë””</label>
      <input id="loginId" name="username" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required
             th:value="${formData.username}"
             type="text">
      <span id="idMessage"></span>

      <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
      <input id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required
             th:value="${formData.password}"
             type="password">
      <span id="pwMessage"></span>

      <label for="passwordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
      <input id="passwordConfirm" name="passwordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
             required th:value="${formData.passwordConfirm}" type="password">
      <span id="pwConfirmMessage"></span>

      <label for="nickname">ë‹‰ë„¤ì„</label>
      <input id="nickname" name="nickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" required
             th:value="${formData.nickname}"
             type="text">
      <span id="nicknameMessage"></span>

      <label for="runnerLevel">ë ˆë²¨</label>
      <select id="runnerLevel" name="runnerLevel" required>
        <option disabled selected value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="BEGINNER">ì´ˆê¸‰ ğŸ‘¶ï¸ 10ë¶„ ì´ìƒ, 2km ì´ìƒ ëŸ¬ë‹ ê°€ëŠ¥</option>
        <option value="INTERMEDIATE">ì¤‘ê¸‰ ğŸš¶ğŸ»â€â¡ï¸ï¸ 20ë¶„ ì´ìƒ, 5km ì´ìƒ ëŸ¬ë‹ ê°€ëŠ¥</option>
        <option value="ADVANCED">ê³ ê¸‰ ğŸƒğŸ»â€â¡ï¸ 30ë¶„ ì´ìƒ, 10km ì´ìƒ ëŸ¬ë‹ ê°€ëŠ¥</option>
      </select>
      <input id="lat" name="lat" type="hidden">
      <input id="lng" name="lng" type="hidden">
      <input id="address" name="address" type="hidden">
    </form>
  </div>


  <div class="location-section">
    <h2>ë‚´ ìœ„ì¹˜ ì„¤ì •</h2>

    <div class="location-search">
      <input id="searchInput" placeholder="í˜„ì¬ ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”(ex. ~êµ¬/~ë™)" type="text">
      <button class="set-location-btn" id="searchBtn">ê²€ìƒ‰</button>
      <button class="set-location-btn" id="currentBtn">ë‚´ ìœ„ì¹˜ ì„¤ì •</button>
    </div>

    <div class="map-container">
      <div class="map" id="map"></div>
      <div class="map-info" id="info">ì§€ë„ì—ì„œ ë‚´ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
      <!--      <img alt="ì§€ë„ ë¯¸ë¦¬ë³´ê¸°" class="map-preview" th:src="@{/images/map_sample.png}">-->
    </div>

    <button class="join-btn" form="signUpForm" type="submit">ê°™ì´ ë‹¬ë¦¬ëŸ¬ ê°€ê¸°</button>
    <div class="signIn-section">
      <p>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?</p>
      <a th:href="@{/api/auth/signIn}">ë¡œê·¸ì¸</a>
    </div>

  </div>
</div>
<script th:inline="javascript">
  const loginIdErrorMessage = /*[[${loginIdErrorMessage}]]*/ null;
  const nickNameErrorMessage = /*[[${nickNameErrorMessage}]]*/ null;

  const signupForm = document.getElementById("signUpForm");

  const loginIdMessage = document.getElementById("idMessage");
  const pwMessage = document.getElementById("pwMessage");
  const pwConfirmMessage = document.getElementById("pwConfirmMessage");
  const nicknameMessage = document.getElementById("nicknameMessage");

  const confirmPassword = document.getElementById("passwordConfirm");
  const password = document.getElementById("password");

  confirmPassword.addEventListener("input", () => {
    passwordConfirm();
  });
  password.addEventListener("input", () => {
    passwordConfirm();
  });

  function passwordConfirm() {
    if (password.value !== confirmPassword.value) {
      pwConfirmMessage.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
      pwConfirmMessage.style.color = "red";
    } else {
      pwConfirmMessage.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
      pwConfirmMessage.style.color = "green";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    if (loginIdErrorMessage != null) {
      loginIdMessage.textContent = loginIdErrorMessage;
      loginIdMessage.style.color = "red";

    }
    if (nickNameErrorMessage != null) {
      nicknameMessage.textContent = nickNameErrorMessage;
      nicknameMessage.style.color = "red";
    }

  });

  signupForm.addEventListener("submit", event => {
    const loginId = document.getElementById("loginId");
    const idRegex = /^[A-Za-z0-9]{8,12}$/;
    const pwRegex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{7,15}$/;
    let valid = true;
    if (!idRegex.test(loginId.value)) {
      valid = false;
      loginIdMessage.textContent = "ì•„ì´ë””ëŠ” ì˜ë¬¸ê³¼ ìˆ«ìê°€ í¬í•¨ëœ 8~12ìë¡œ ì œí•œë©ë‹ˆë‹¤."
      loginIdMessage.style.color = "red";
    } else {
      loginIdMessage.textContent = "";
    }
    if (!pwRegex.test(password.value)) {
      valid = false;
      pwMessage.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 1ê°œì˜ ëŒ€ë¬¸ì, ìˆ«ì ë° íŠ¹ìˆ˜ê¸°í˜¸ê°€ í¬í•¨ëœ 7~15ìë¡œ ì œí•œë©ë‹ˆë‹¤.";
      pwMessage.style.color = "red";
    } else {
      pwMessage.textContent = "";
    }
    if (!valid) {
      event.preventDefault();
    }
  });


</script>
</body>
</html>